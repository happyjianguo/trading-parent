<#bs4Body>

<style type="text/css">
    ul{width:500px;list-style:none;border: 1px solid black;}
    li{width:48%;margin:1%;float:left;}
</style>
<div class="container-fluid">
        <input type="hidden" id="_sourceChannel" value="<#config name='ia.source.channel.earnest_order'/>">
        <form id="saveForm" role="form" novalidate>
            <input type="hidden" class="form-control" name="goodsId" value="${model.goodsId}" placeholder="">
            <input type="hidden" class="form-control" name="parentGoodsId" value="${model.parentGoodsId}" placeholder="">
            <div   id= "menu ">
                <ul>
                    <li>
                        <div ><label for="">商品品类</label></div>
                        <div ><label for="">匹配规则</label></div>
                        <div id="priceTitleDiv" Style="display: none;"><label for="">固定价格</label></div>
                    </li>
                    <li>
                        <div >
                            <input type="text" name="goodsName" class="form-control" readonly="readonly" value="${model.goodsName}" placeholder="">
                        </div>
                        <div >
                            <select id="referenceRule" onchange="changeDivDisplay();" name="referenceRule" class="form-control"></select>
                            <#bcomboProvider _id="referenceRule" _provider="referenceRuleProvider" _queryParams='{}'/>
                        </div>
                        <div  id="priceValueDiv" Style="display: none;">
                            <input type="text" name="fixedPrice" class="form-control" value="${model.fixedPrice}" placeholder="">
                        </div>
                    </li>
                </ul>
            </div>
        </form>
    </div>
</#bs4Body>


    <script>
        function changeDivDisplay(){
            var referenceRule = $("#referenceRule").val();
            if(referenceRule == '3'){
                document.getElementById("priceTitleDiv").style.display = "block";
                document.getElementById("priceValueDiv").style.display = "block";
            }
            else {
                document.getElementById("priceTitleDiv").style.display = "none";
                document.getElementById("priceValueDiv").style.display = "none";
            }
        }

        function saveOrUpdateHandler() {
            // 提交保存
            if (!$('#saveForm').validate().form()) {
                return false;
            }
            bui.loading.show('努力提交中，请稍候。。。');
            var obj=$('#saveForm')[0];
            let _formData = new FormData($('#saveForm')[0]);
            $.ajax({
                type: "POST",
                url: "/goodsReferencePriceSetting/insert.action",
                data: _formData,
                processData: false,
                contentType: false,
                async: true,
                success: function (res) {
                    bui.loading.hide();
                    if (res.code == "200") {
                        bs4pop.alert('成功', {type: 'success'}, function () {
                            /* 应该要带条件刷新 */
                            parent.dia.hide();
                            parent.location.reload();
                        });
                    } else {
                        bui.loading.hide();
                        bs4pop.alert(res.errorData, {type: 'error'});
                    }
                },
                error: function (error) {
                    bui.loading.hide();
                    bs4pop.alert(error.result, {type: 'error'});
                }
            });
        }
    </script>