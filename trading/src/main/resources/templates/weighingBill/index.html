<#bs4Body>
<div class="container-fluid">
	<#bs4nav>
	<form class="form" id="queryForm" role="form">
		<div class="row  row-cols-6">
			<div class="form-group col">
				<label for="">单据状态</label> <select id="state" name="state" class="form-control">
				</select>
				<#bcomboProvider _id="state" _provider="weighingBillStateProvider" _queryParams='{emptyText:"-- 全部 --"}'/>
			</div>
			<div class="form-group col">
				<label for="">交易类型</label> <select id="tradeType" name="tradeType" class="form-control">
				</select>
				<#bcomboProvider _id="tradeType" _provider="dataDictionaryValueProvider" _queryParams='{dd_code:"trade_type",emptyText:"-- 全部 --"}' />
			</div>
			<div class="form-group col">
				<label for="">商品名称</label> <input type="text" class="form-control" name="goodsSplitStr" placeholder="">
			</div>
			<div class="form-group col-auto" style="width: 350px">
                <label for="buyerName" class="">买家</label>
                <div class="input-group">
                    <#bautoCompleteProvider _hiddenDomainId="buyerId" _hiddenDomainName="buyerId" _displayDomainId="buyerCode" _displayDomainName="buyerCode" _placeholder="" _optionVariable="buyerNameQueryAutoCompleteOption"/>
                    <input type="text" class="form-control" id="show_buyer_name" readonly/>
                </div>
            </div>
			<div class="form-group col-auto" style="width: 350px">
				<label for="sellerName" class="">卖家</label>
                <div class="input-group">
                    <#bautoCompleteProvider _hiddenDomainId="sellerId" _hiddenDomainName="sellerId" _displayDomainId="sellerCode" _displayDomainName="sellerCode" _placeholder="" _optionVariable="sellerNameQueryAutoCompleteOption"/>
                    <input type="text" class="form-control" id="show_seller_name" readonly/>
                </div>
            </div>
            <div class="form-group col">
				<label for="">过磅单号</label> <input type="text" class="form-control" name="serialNo" placeholder="">
			</div>
			<div class="form-group col">
				<label for="">结算单号</label> <input type="text" class="form-control" name="wsSerialNo" placeholder="">
			</div>
			<div class="form-group col">
                <label for="buyerName" class="">结算员</label>
                <div class="input-group">
                    <#bautoCompleteProvider _hiddenDomainId="operatorId" _hiddenDomainName="operatorId" _displayDomainId="realName" _displayDomainName="realName" _placeholder="" _optionVariable="operatorNameAutoCompleteOption"/>
                    <!--<input type="text" class="form-control" id="show_operator_name" readonly/>-->
                </div>
            </div>
			<div class="form-group col-auto" style="width: 350px">
                <label for="buyerName" class="">买家卡</label>
                <div class="input-group">
                    <!--<#bautoCompleteProvider _displayDomainId="buyerCardNo" _displayDomainName="buyerCardNo" _placeholder="" _optionVariable="buyerCardQueryAutoCompleteOption"/>-->
                    <input type="text" class="form-control" id="buyerCardNo" name="buyerCardNo"/>
                    <input type="text" class="form-control" id="show_buyer_name_by_card_name" readonly/>
                    <!--<button type="button" class="btn btn-outline-primary mr-2" onclick="javascript:swipeCard();">-->
						<!--<i class="fa fa-refresh"></i>刷卡-->
					<!--</button>-->
                </div>
            </div>
			<div class="form-group col-auto" style="width: 350px">
				<label for="sellerName" class="">卖家卡</label>
				<div class="input-group">
					<!--<#bautoCompleteProvider _displayDomainId="sellerCardNo" _displayDomainName="sellerCardNo" _placeholder="" _optionVariable="sellerCardQueryAutoCompleteOption"/>-->
					<input type="text" class="form-control" id="sellerCardNo" name="sellerCardNo"/>
					<input type="text" class="form-control" id="show_seller_name_by_card_name" readonly/>
					<!--<button type="button" class="btn btn-outline-primary mr-2" onclick="javascript:swipeCard();">-->
						<!--<i class="fa fa-refresh"></i>刷卡-->
					<!--</button>-->
				</div>
			</div>
			<div class="form-group col">
				<label for="">车牌号</label> <input type="text" class="form-control" name="plateNumber" placeholder="">
			</div>
			<div class="form-group col">
				<label for="unitPriceStart">单价</label>
				<div class="form-inline">
					<div class="input-group">
						<input type="text" name="unitPriceStart" id="unitPriceStart" class="form-control isNaturalNum laystart" />
						&nbsp;&nbsp;至&nbsp;&nbsp;
						<input type="text" name="unitPriceEnd" id="unitPriceEnd" class="form-control isNaturalNum layend" value="" />
					</div>

				</div>
			</div>
			<div class="form-group col-auto">
				<label for="createdStart">结算时间</label>
				<div class="form-inline">
					<div class="input-group">
						<input type="text" value="${createdStart!}" name="createdStart" id="createdStart" class="form-control laydatetime laystart" />
						<div class="input-group-append">
							<label for="createdStart" class="input-group-text fa fa-calendar"></label>
						</div>
					</div>
					&nbsp;&nbsp;至&nbsp;&nbsp;
					<div class="input-group">
						<input type="text" value="${createdEnd!}" name="createdEnd" id="createdEnd" class="form-control laydatetime layend" value="" />
						<div class="input-group-append">
							<label for="createdEnd" class="input-group-text fa fa-calendar"></label>
						</div>
					</div>
				</div>
			</div>


			<div class="col-auto align-self-center mt-3">
				<button type="button" class="btn btn-outline-primary mr-2" onclick="javascript:$('#queryForm input').val('');">
					<i class="fa fa-refresh"></i> 清空
				</button>
				<button type="button" class="btn btn-outline-primary mr-2" onclick="queryDataHandler()">
					<i class="fa fa-search"></i> 查询
				</button>
				<button type="button" class="btn btn-outline-primary" onclick="javascript:swipeCard();">
					<i class="fa fa-refresh"></i> 刷卡
				</button>
			</div>
		</div>
	</form>
	</#bs4nav>
	<hr>
	<div class="row">
		<div class="col-12">
			<div id="toolbar" class="btn-group" role="group" aria-label="Toolbar with button groups">
				<#resource code="truck_add">
				<button id="btn_add" type="button" class="btn btn-primary" onclick="invalidate()">
					<i class="fa fa-plus"></i> 作废
				</button>
				</#resource>
				<#resource code="truck_edit">
				<button type="button" class="btn btn-primary" onclick="withdraw()">
					<i class="fa fa-pencil-square-o"></i> 撤销
				</button>
				</#resource>
				<#resource code="truck_del">
				<button type="button" class="btn btn-primary" onclick="openDetailHandler()">
					<i class="fa fa-trash-o"></i> 查看
				</button>
				</#resource>
				<#resource code="truck_view">
				<button type="button" class="btn btn-primary" onclick="openPrintHandler()">
					<i class="fa fa-eye"></i> 补打单据
				</button>
				</#resource>
				<#resource code="truck_on">
				<button type="button" class="btn btn-primary btn_css_disabled" id="btn_enabled" onclick="doEnableHandler(1)">
					<i class="fa fa-play"></i> 打印
				</button>
				</#resource>
				<#resource code="truck_off">
					<button id="export" type="button" class="btn btn-primary" onclick="bui.util.doExport('grid','queryForm')"><i class="fa fa-download"></i> 导出</button>
				</#resource>
			</div>
			<table id="grid" data-toggle="table" data-title="过磅单列表" class="table" data-toolbar="#toolbar" data-pagination="true" data-page-number="1" data-page-size="10" data-query-params="queryParams"
				data-side-pagination="server" data-method="POST" data-content-type="application/x-www-form-urlencoded" data-single-select="true" data-click-to-select="true" data-checkbox-header="true"
				data-unique-id="id" data-sort-name="id" data-sort-order="desc" data-icons="bui.variable.icons" data-buttons-class="primary" data-show-refresh="true" data-show-fullscreen="true"
				data-show-columns="true">
				<thead>
					<tr>
						<th data-radio="true"></th>
						<th data-field="serialNo" data-align="center" data-sortable="true">过磅单号</th>
						<th data-field="statement.serialNo" data-align="center" data-sortable="true">结算单号</th>
						<th data-field="buyerCode" data-align="center" data-sortable="true">买方编号</th>
						<th data-field="buyerName" data-align="center" data-sortable="true">买方名称</th>
						<th data-field="buyerCardNo" data-align="center" data-sortable="true">买方卡号</th>
						<th data-field="sellerCode" data-align="center" data-sortable="true">卖方编号</th>
						<th data-field="sellerName" data-align="center" data-sortable="true">卖方名称</th>
						<th data-field="sellerCardNo" data-align="center" data-sortable="true">卖方卡号</th>
						<th data-field="goodsName" data-align="center" data-sortable="true">商品</th>
						<!-- <th data-field="goodsName" data-align="center" data-sort-name="created" data-provider="datetimeProvider" data-sortable="true">商品</th> -->
						<th data-field="roughWeight" data-align="center" data-sortable="true" data-provider="weightProvider">毛重</th>
						<th data-field="tareWeight" data-align="center" data-sortable="true">皮重</th>
						<th data-field="netWeight" data-align="center" data-sortable="true" data-provider="weightProvider">净重</th>
						<th data-field="unitAmount" data-align="center" data-sortable="true">件数</th>
						<th data-field="unitWeight" data-align="center" data-sortable="true" data-provider="weightProvider">件重</th>
						<th data-field="unitPiecePrice" data-align="center" data-sortable="true" data-provider="moneyProvider">件价(元/件)</th>
						<th data-field="unitWeightPrice" data-align="center" data-sortable="true" data-provider="moneyProvider">单价(元/公斤)</th>
						<th data-field="statement.tradeAmount" data-align="center" data-sortable="true" data-provider="moneyProvider">交易金额</th>
						<th data-field="statement.buyerPoundage" data-align="center" data-sortable="true" data-provider="moneyProvider">买方手续费</th>
						<th data-field="statement.buyerActualAmount" data-align="center" data-sortable="true" data-provider="moneyProvider">买方实付</th>
						<th data-field="statement.sellerPoundage" data-align="center" data-sortable="true" data-provider="moneyProvider">卖方手续费</th>
						<th data-field="statement.sellerActualAmount" data-align="center" data-sortable="true" data-provider="moneyProvider">卖方实收</th>
						<th data-field="tradeType" data-align="center" data-sortable="true" data-provider="tradeTypeProvider">交易类型</th>
						<th data-field="plateNumber" data-align="center" data-sortable="true">车牌号</th>
						<th data-field="statement.state" data-align="center" data-sortable="true" data-provider="weighingStatementStateProvider">单据状态</th>
						<th data-field="operationRecord.operatorId" data-align="center" data-sortable="true">结算员工号</th>
						<th data-field="operationRecord.operatorName" data-align="center" data-sortable="true">结算员名称</th>
						<th data-field="operationRecord.operationTime" data-align="center" data-sortable="true" data-provider="datetimeProvider">结算时间</th>
						<th data-field="" data-align="center" data-sortable="true">检测值</th>
						<th data-field="" data-align="center" data-sortable="true">检测结果</th>
					</tr>
				</thead>
			</table>
		</div>
	</div>
</div>

</#bs4Body>

<div class="modal fade" id="_modal" data-backdrop="static" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <!--modal-lg modal-sm(默认) 通过设置mw大小调整宽度（如mw-100） modal-dialog-centered垂直居中-->
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <!-- 标题 -->
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
        </div>
    </div>
</div>

<script>
    $(function(){
        $('#buyerCardNo').on('input', function (cardNo) {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: '/weighingBill/listCustomerByCardNo.action',
                data: {cardNo: $(this).val()},
                success: function (data) {
                    if (data.code == '200') {
                        $('#show_buyer_name_by_card_name').val(data.data.customerName);
                    }else{
                        $('#show_buyer_name_by_card_name').val('');
                        // bs4pop.alert("客户获取失败!", {type: 'error'});
					}
                },
                error: function () {
                    bui.loading.hide();
                    bs4pop.alert("客户获取失败!", {type: 'error'});
                }
            });
        })
        $('#sellerCardNo').on('input', function (cardNo) {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: '/weighingBill/listCustomerByCardNo.action',
                data: {cardNo: $(this).val()},
                success: function (data) {
                    if (data.code == '200') {
                        $('#show_seller_name_by_card_name').val(data.data.customerName);
                    }else{
                        $('#show_seller_name_by_card_name').val('');
                        // bs4pop.alert("客户获取失败!", {type: 'error'});
					}
                },
                error: function () {
                    bui.loading.hide();
                    bs4pop.alert("客户获取失败!", {type: 'error'});
                }
            });
        })
    })
</script>


<script type="text/javascript">
<#weighingBill_indexJs />
</script>